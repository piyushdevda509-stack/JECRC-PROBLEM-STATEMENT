{% extends 'base.html' %}

{% block content %}
<div class="dashboard-box">
    <h2>üìå Manage Problems</h2>
    <a href="{{ url_for('admin_add_problem') }}" class="btn-3d">‚ûï Add Problem</a>

    <table class="styled-table">
        <thead>
            <tr>
                <th>#</th>
                <th>Title</th>
                <th>Skill</th>
                <th>Category</th>
                <th>Branch</th>
                <th>External Link</th>
                <th>üìÑ Synopsis</th>
                <th>üìë Report</th>
                <th>üéì Certificate</th>
                <th>Created By</th>
                <th>Status</th>
                <th style="min-width:250px;">Actions</th>
            </tr>
        </thead>
        <tbody>
            {% if problems %}
                {% for p in problems %}
                {% set st = (p['status'] or '')|lower %}
                <tr>
                    <td>{{ loop.index }}</td>
                    <td><strong>{{ p['title'] }}</strong></td>
                    <td>{{ p['skill'] }}</td>
                    <td>{{ p['category'] }}</td>

                    <!-- Branch badge -->
                    <td>
                        {% set branch_colors = {
                            'CSE': '#007bff',
                            'IT': '#28a745',
                            'ECE': '#ff9800',
                            'EEE': '#9c27b0',
                            'ME': '#795548',
                            'AIDS': '#6a1b9a'
                        } %}
                        {% set color = branch_colors.get(p['branch'], '#607d8b') %}
                        <span class="badge" style="background:{{ color }};">
                            {{ p['branch'] }}
                        </span>
                    </td>

                    <!-- External link -->
<td>
    {% if p['external_link'] %}
        <a href="{{ p['external_link'] }}" target="_blank" rel="noopener">üîó Link</a>
    {% else %}
        ‚Äî
    {% endif %}
</td>

<!-- Synopsis -->
<td>
    {% if p['synopsis_path'] %}
        <a href="{{ url_for('serve_upload', relpath=p['synopsis_path'].replace('uploads/', '')) }}" 
           target="_blank" rel="noopener">üìÑ View</a>
    {% else %}
        ‚Äî
    {% endif %}
</td>

<!-- Report -->
<td>
    {% if p['report_path'] %}
        <a href="{{ url_for('serve_upload', relpath=p['report_path'].replace('uploads/', '')) }}" 
           target="_blank" rel="noopener">üìë View</a>
    {% else %}
        ‚Äî
    {% endif %}
</td>

<!-- Certificate -->
<td>
    {% if p['certificate_path'] %}
        <a href="{{ url_for('serve_upload', relpath=p['certificate_path'].replace('uploads/', '')) }}" 
           target="_blank" rel="noopener">üéì View</a>
    {% else %}
        ‚Äî
    {% endif %}
</td>

<!-- Created By -->
<td>
    <strong>{{ p['created_by_name'] }}</strong><br>
    <small>{{ p['created_by_roll'] }} | {{ p['created_by_branch'] }} - {{ p['created_by_batch'] }}</small>
</td>


                    <!-- Status -->
                    <td>
                        {% if st == "approved" %}
                            <span class="status approved">‚úî Approved</span>
                        {% elif st == "rejected" %}
                            <span class="status rejected">‚ùå Rejected</span>
                            {% if p['rejection_reason'] %}
                                <br><small>{{ p['rejection_reason'] }}</small>
                            {% endif %}
                        {% else %}
                            <span class="status pending">‚è≥ Pending</span>
                        {% endif %}
                    </td>

                    <!-- Actions -->
                    <td>
                        <div class="action-buttons">
                            <a href="{{ url_for('admin_edit_problem', problem_id=p['id']) }}" class="btn-action edit">‚úèÔ∏è Edit</a>
                            <a href="{{ url_for('admin_delete_problem', problem_id=p['id']) }}"
                               class="btn-action delete"
                               onclick="return confirm('‚ùó Are you sure you want to delete this problem?')">üóë Delete</a>

                            {% if st == "pending" %}
                                <a href="{{ url_for('admin_approve_problem', problem_id=p['id']) }}" class="btn-action approve">‚úî Approve</a>
                                <a href="{{ url_for('admin_reject_problem', problem_id=p['id']) }}" class="btn-action reject">‚ùå Reject</a>
                            {% elif st == "approved" %}
                                <a href="{{ url_for('admin_reject_problem', problem_id=p['id']) }}" class="btn-action reject">‚ùå Reject</a>
                            {% elif st == "rejected" %}
                                <a href="{{ url_for('admin_approve_problem', problem_id=p['id']) }}" class="btn-action approve">‚úî Approve</a>
                            {% endif %}
                        </div>
                    </td>
                </tr>
                {% endfor %}
            {% else %}
                <tr>
                    <td colspan="12" style="text-align:center; color:gray; padding:15px;">
                        ‚ö† No problems added yet.
                    </td>
                </tr>
            {% endif %}
        </tbody>
    </table>
</div>

<!-- Extra CSS -->
<style>
    .badge {
        color: white;
        padding: 4px 8px;
        border-radius: 6px;
        font-size: 12px;
        display: inline-block;
    }
    .status {
        font-weight: bold;
        padding: 4px 10px;
        border-radius: 6px;
        font-size: 12px;
        display: inline-block;
    }
    .status.approved { background: #e6ffed; color: #008000; }
    .status.rejected { background: #ffe6e6; color: #d32f2f; }
    .status.pending { background: #fff3cd; color: #856404; }

    .action-buttons {
        display: flex;
        flex-wrap: wrap;
        gap: 6px;
    }
    .btn-action {
        padding: 4px 10px;
        border-radius: 6px;
        text-decoration: none;
        font-size: 13px;
        transition: 0.2s;
    }
    .btn-action.edit { background:#2196f3; color:white; }
    .btn-action.edit:hover { background:#1976d2; }
    .btn-action.delete { background:#f44336; color:white; }
    .btn-action.delete:hover { background:#c62828; }
    .btn-action.approve { background:#4caf50; color:white; }
    .btn-action.approve:hover { background:#2e7d32; }
    .btn-action.reject { background:#ff9800; color:white; }
    .btn-action.reject:hover { background:#e65100; }
</style>
{% endblock %}
